#Bar Plot
#Developed by Felipe Tempone

import numpy as np
import pandas as pd
import matplotlib as mpl
import matplotlib.pyplot as plt
import seaborn as sns


#Dataframe
df = pd.read_excel(
    r"file_path.xlsx",'Brazil') #endereço do arquivo + a Tab

#abels and sizes column names
labels_column = "Month" #coluna de títulos
sizes_column = "Actual" #coluna de valores
varlinha = "Budget" #linha de tendência


height = df[sizes_column].tolist()
width = df[labels_column].tolist()
varli = df[varlinha].tolist()

df_used=df[ [labels_column,sizes_column,varlinha] ]

plt.figure(figsize=(15,5))
cor="lightsteelblue"
plt.bar(width, height, align='center',color=cor)

import matplotlib.patches as mpatches

class AnyObject(object):
    pass

class AnyObjectHandler(object):
    def legend_artist(self, legend, orig_handle, fontsize, handlebox):
        x0, y0 = handlebox.xdescent, handlebox.ydescent
        width, height = handlebox.width, handlebox.height
        patch = mpatches.Rectangle([x0, y0], width, height, facecolor=cor,lw=4,transform=handlebox.get_transform())
        handlebox.add_artist(patch)
        return patch

plt.legend([AnyObject()], [sizes_column],
           handler_map={AnyObject: AnyObjectHandler()})

if max(height)>max(varli):
    maximo = max(height)
else:
    maximo=max(varli)

plt.title(' ')
plt.ylim(0, maximo) #Escala Y_1
ax = plt.gca()
ax = df[varlinha].plot(secondary_y=True,xlim=ax.get_xlim(),color='midnightblue')

ax.set_xlabel(labels_column)
ax.set_ylabel(sizes_column)

sns.despine(top=True, right=False, left=False, bottom=False)

ax.spines['bottom'].set_color('w')
ax.spines['left'].set_color('w')
ax.spines['top'].set_color('w')
ax.spines['right'].set_color('w')

plt.ylim(0, maximo)   #Escala Y_2

plt.ylabel(" ")

plt.legend(bbox_to_anchor=(0.8, 1), loc='upper left')

plt.savefig(r'file_path\BarLinePlot.png',transparent=True, bbox_inches='tight',dpi=500)

plt.show()
